{% extends "index.html" %}
{% block titulo %}
PONTO DE ARRECADAÇÃO
{% endblock %}
{% block nav-bar %}      
    <!---------------------------------Criar ponto de arrecadação---------------------------------->
    <div class="row">
        <div class="col-lg-12">
            <div class="card crud-bar">
                <div class="row justify-content-center align-items-center form-group">
                    <div class="col-12 row justify-content-end">
                        <button type="button" id="cadastrar-ponto" class="btn btn-lg text-right btn-success btn-create btn-create-secondary" data-toggle="modal" data-target="#modal-equipamento">
                            <em class="icon ni ni-plus"></em>
                            <p>Criar ponto de arrecadação</p>
                        </button>
                        <div class="modal fade" tabindex="-1" id="modal-equipamento">
                            <div class="modal-dialog modal-md" role="document">
                                <div class="modal-content">
                                    <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                                        <em class="icon ni ni-cross"></em>
                                    </a>

                                    <div class="alert alert-fill alert-secondary alert-icon header-modal">
                                        <em class="icon ni ni-pen-fill"></em>
                                        <h6>Adicionar Ponto de Arrecadação</h6>
                                    </div>

                                    <form class="modal-body" method="post" id="form1">{% csrf_token %}

                                        <div class="form-group" action="" method="post">
                                            <div class="row container-form-modal">
                                                <div class="col-lg-6 col-sm-6 container-input-create">
                                                    <div class="form-group">
                                                        <div class="form-control-wrap">
                                                            {{ form.gerencia }}
                                                            <label class="form-label-outlined" for="id_franquia">Gerencia</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-5 col-sm-6 container-input-create">
                                                    <div class="form-group">
                                                        <div class="form-control-wrap">
                                                            {{ form.leiturista }}
                                                            <label class="form-label-outlined" for="id_franquia">Leiturista</label>
                                                        </div>
                                                        {% if form.leiturista.errors %}
                                                        <div class="error-campo">
                                                            {{ form.leiturista.errors }}
                                                        </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                <div class="row justify-content-end col-lg-1 col-sm-6 container-input-create">
                                                    <div class="form-group">
                                                        <div class="form-control-wrap">
                                                            <button type="button" id="leiturista-create" class="btn btn-sm btn-success">
                                                                <em class="icon ni ni-plus"></em>
                                                            </button>
                                                            <button type="button" id="leiturista-remove" class="btn btn-sm btn-danger">
                                                                <em class="icon ni ni-minus-sm"></em>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="block" class="row container-form-modal">
                                                <div class="col-lg-6 col-sm-6 container-input-create">
                                                    <div class="form-group">
                                                        <div class="form-control-wrap">
                                                            {{ form.nome }}
                                                            <label class="form-label-outlined" for="id_nome">Nome</label>
                                                        </div>
                                                        {% if form.nome.errors %}
                                                        <div class="error-campo">
                                                            {{ form.nome.errors }}
                                                        </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 col-sm-6 container-input-create">
                                                    <div class="form-group">
                                                        <div class="form-control-wrap">
                                                            {{ form.login }}
                                                            <label class="form-label-outlined" for="id_franquia">Login</label>
                                                        </div>
                                                        {% if form.login.errors %}
                                                        <div class="error-campo">
                                                            {{ form.login.errors }}
                                                        </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 col-sm-6 container-input-create">
                                                    <div class="form-group">
                                                        <div class="form-control-wrap">
                                                            {{ form.senha }}
                                                            <label class="form-label-outlined" for="id_franquia">Senha</label>
                                                        </div>
                                                        {% if form.senha.errors %}
                                                        <div class="error-campo">
                                                            {{ form.senha.errors }}
                                                        </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 col-sm-6 container-input-create">
                                                    <div class="form-group">
                                                        <div class="form-control-wrap">
                                                            {{ form.confirmar_senha }}
                                                            <label class="form-label-outlined" for="id_franquia">Confirmar Senha</label>
                                                        </div>
                                                        {% if form.confirmar_senha.errors %}
                                                        <div class="error-campo">
                                                            {{ form.confirmar_senha.errors }}
                                                        </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row container-form-modal">
                                                <div class="row justify-content-end col-12 container-input-create">
                                                    <button type="submit" form='form1' class="btn btn-sm btn-success">
                                                        salvar
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-------------------------------tabela de generica de franquias-------------------------------->

    <div class="row my-row">
        <div class="col-12">
            <div class="card table-margin table-responsive-xl">
                <table id="tabelaLeiturista" class="table">
                    <thead class="thead-dark text-center">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Gerência</th>
                            <th scope="col">Gerente</th>
                            <th scope="col">Franquia</th>
                            <th scope="col">Situação</th>
                            <th scope="col">Leiturista atual</th>
                            {% if request.session.perfil_max < 5 %}
                            {% if usuarios %}
                            <th scope="col">Alterar leiturista para</th>
                            {% endif %}
                            {% endif %}
                            <th scope="col">Estabelecimentos</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody class="text-center">
                    {% for pa in pontos_de_arrecadacao %}

                        <tr>
                            <td>{{ pa.codigo }}</td>
                            <td>{{ pa.gerencia.codigo }}</td>
                            <td>{{ pa.gerencia.gerente }}</td>
                            <td>{{ pa.gerencia.franquia }}</td>
                            <td>{% if pa.ativo %}ATIVO{% else %}INATIVO{% endif %}</td>
                            <td>{% if pa.leiturista %}{{ pa.leiturista }}{% endif %}</td>
                            {% if request.session.perfil_max < 5 %}
                            {% if usuarios %}
                            <td>
                                <form method="post">{% csrf_token %}
                                    <select class="form-control form-select-sm form-control-outlined select-pdv" name="novoleiturista" onchange="this.form.submit();">
                                        <option value="" selected></option>
                                        {% for u in usuarios %}
                                            {% if pa.gerencia.franquia in u.franquias.all %}
                                                <option value="{{ pa.id }},{{ u.id }}">{{ u.usuario.get_full_name }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </form>
                            </td>
                            {% endif %}
                            {% endif %}
                            <td>
                                <p class="paragrafo-pdv" data-toggle="modal" data-target="#modal-arrecadacao-{{ pa.id }}">{{ pa.estabelecimentos.all.0 }}... <span class="btn btn-primary span-plus"><em class="icon ni ni-arrow-down"></em></span></p>
                            </td>
                            <div class="modal fade" tabindex="-1" id="modal-arrecadacao-{{ pa.id }}" style="display: none;" aria-hidden="true">
                                <div class="modal-dialog modal-md" role="document">
                                    <div class="modal-content">
                                        <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                                            <em class="icon ni ni-cross"></em>
                                        </a>
                                        <div class="modal-header modal-header-estabelecimento row">
                                            <p class="col-sm-6 modal-title">Estabelecimentos</p>
                                        </div>
                                        <div class="row modal-body modal-body-estabelecimento">
                                            <ul class="row col-12">
                                                {% for estabelecimentoPdv in pa.estabelecimentos.all %}
                                                    <li class="col-sm-6"><p class="container-list-estabelecimento"><em class="icon ni ni-square-fill-c"></em></em>{{ estabelecimentoPdv }}</p></li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <td>
                                <button class="btn btn-success btn-create-secondary btn-modal" data-toggle="modal" data-target="#modalDefault{{ pa.id }}">
                                    <em class="icon ni ni-plus-sm"></em>
                                </button>
                            </td>

                            <!-------------------------modal-------------------------->
                            <div class="modal fade" tabindex="-1" id="modalDefault{{ pa.id }}">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content" id="modal-content{{ pa.id }}">
                                        <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                                            <em class="icon ni ni-cross"></em>
                                        </a>
                                        
                                        <div id="container_title_modal" class="alert alert-fill alert-success alert-icon header-modal">
                                            <em class="icon ni ni-alert-circle"></em>
                                            <h6 id="title_modal">Estabelecimentos vinculados ao leiturista</h6>
                                        </div>
                                    
                                        <form class="modal-body-2" method="post">{% csrf_token %}
                                            <input type="hidden" name="ponto_de_arrecadacao_id" value="{{ pa.id }}">
                                            <div class="form-group" action="" method="post">
                                                <div class="row container-form-modal">
    
                                                    <div class="col-lg-12 col-sm-12 row container-input-create">
                                                        <h6 class="title-check col-6">Estabelecimentos</h6>
                                                        <div class="col-6 row justify-content-end">
                                                            <a class="btn btn-success btn-create-secondary btn-checkbox checkbox-all" value="{{ pa.id }}" id="checkbox-all">
                                                                <em class="icon ni ni-check-round"></em>
                                                                <p class="checkbox-text">Selecionar todos</p>
                                                            </a>
                                                            <a class="btn btn-danger btn-create-secondary btn-checkbox checkbox-none" id="checkbox-none">
                                                                <em class="icon ni ni-square"></em>
                                                                <p class="checkbox-text-none">Desmarcar todos</p>
                                                            </a>
                                                        </div>
                                                        {% for e in estabelecimentos %}
                                                            {% if pa.gerencia in e.gerencias.all %}
                                                                <div class="col-sm-6 container-check">
                                                                    <div>
                                                                        <input type="checkbox" name="{{ e.id }}" class="select-all-{{ pa.id }}"
                                                                            {% if e in pa.estabelecimentos.all %}checked{% endif %}>
                                                                    </div>
                                                                    <label class="label-checkbox">{{ e }}</label>
                                                                </div>
                                                            {% endif %}
                                                        {% endfor %}
                                                        <script>
                                                            $('.checkbox-all').click(function () {
                                                                $('.select-all-{{ pa.id }}').attr("checked", true);
                                                            })

                                                            $('.checkbox-none').click(function () {
                                                                $('.select-all-{{ pa.id }}').attr("checked", false);
                                                            })

                                                        </script>
                                                    </div>

                                                </div>
                                            </div>

                                            <div class="modal-footer bg-light">
                                                <div class="row justify-content-between form-group">
                                                    
                                                    <div class="form-control-wrap">
                                                        <button type="submit" href="{{ request.path }}" class="btn btn-modal btn-success" >Salvar</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <!--
                            <td class="text-center">
                                <a href="/franquia/{{ f.id }}/" class="btn btn-success">
                                    <em class="icon ni ni-pen-fill"></em>
                                    <p>Editar</p>
                                </a>
                                <a href="/user/{{ f.dono.id }}/status/"
                                    class="btn {% if p.leiturista.ativo %}btn-danger{% else %}btn-success{% endif %}">

                                    <p>{% if p.leiturista.ativo %}Desativar{% else %}Ativar{% endif %}</p>
                                </a>
                            </td>
                            -->
                        </tr>

                    {% endfor %}

                    </tbody>
                    </table>

            </div>
        </div>
    </div>
    <!-------------------------------------------------------------------------------------------->
    <!-------------------------------tabela de generica de usuarios candidatos a leituristas-------------------------------->
    <div class="row my-row">
        <div class="col-12">
            <div class="card table-margin table-responsive-xl">
                <table id="tabelaLeiturista" class="table">
                    <thead class="thead-dark text-center">
                        <tr>
                            <th scope="col" colspan="5"><h6 style="color:white" >Lista de candidatos a leiturista</h6></th>
                        </tr>
                        <tr>
                            <th scope="row">#</th>
                            <th scope="col">nome</th>
                            <th scope="col">login</th>
                            <th scope="col">Perfis</th>
                        </tr>
                    </thead>
                    <tbody class="text-center">
                    {% for u in usuarios %}
                        <tr>
                            <td scope="row">{{ u.id }}</td>
                            <td>{{ u.usuario.get_full_name }}</td>
                            <td>{{ u.usuario.username }}</td>
                            <td>{{ u.perfis.all|join:", " }}</td>
                        </tr>

                    {% endfor %}

                    </tbody>
                    </table>

            </div>
        </div>
    </div>
    <!-------------------------------------------------------------------------------------------->
<script>
    $(function () {
        let modal = $('#modal-content');
        modal.css('display','flex')
    })
     $(document).ready( function () {
    //     $('#tabelaCandidato').DataTable({
    //         "language": {
    //             "url":"https://cdn.datatables.net/plug-ins/1.10.24/i18n/Portuguese-Brasil.json",
    //         },
    //         "dom": '',
    //         paging: false  
    //     });
         $('#tabelaLeiturista').DataTable({
             "language": {
                 "url":"https://cdn.datatables.net/plug-ins/1.10.24/i18n/Portuguese-Brasil.json",
             },
             "dom": '',
             paging: false,
             columnDefs: [
                 { orderable: false, targets: [5,7] }
             ],   
         });
     } );

    // /*******************************************/

    // $('.checkbox-all').mouseover(function () {
    //     const styleAdd= {
    //         display:'flex',
    //         color:'#ffffff'
    //     }
    //     let checkboxText = $('.checkbox-text');
    //     checkboxText.css(styleAdd);
    // })
    
    // $('.checkbox-all').mouseout(function () {
    //     const styleRemove = {
    //         display:'none'
    //     }
    //     let checkboxText = $('.checkbox-text');
    //     checkboxText.css(styleRemove);
    // })

    // /*******************************************/

    // $('.checkbox-none').mouseover(function () {
    //     const styleAdd= {
    //         display:'flex',
    //         color:'#ffffff'
    //     }
    //     let checkboxText = $('.checkbox-text-none');
    //     checkboxText.css(styleAdd);
    // })

    // $('.checkbox-none').mouseout(function () {
    //     const styleRemove = {
    //         display:'none'
    //     }
    //     let checkboxText = $('.checkbox-text-none');
    //     checkboxText.css(styleRemove);
    // })
    
    const erroCad = {% if form.leiturista.errors or form.nome.errors or form.login.errors or form.senha.errors or form.confirmar_senha.errors %} true {% else %} false {% endif %};
</script>

<script src="/static/script/ponto_de_arrecadacao.js"></script>

    <!-- content @e -->
{% endblock %}