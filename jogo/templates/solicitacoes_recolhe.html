{% extends "index.html" %}
{% block titulo %}
SOLICITAÇÕES DE RECOLHE
{% endblock %}
{% block nav-bar %}

<div class="row my-row">
    <div class="col-12">
        <div class="card crud-bar">
            <div class="row justify-content-center align-items-center form-group">
                <form action="/solicitacoes_recolhe/" method="post" class="col-xs-12 col-sm-12 col-md-12 col-xl-12 row justify-content-start" id="form1" name="form1">
                {% csrf_token %}
                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 container-input-create-secundary">
                        <div class="form-group">
                            <div class="form-control-wrap">
                                <div class="form-icon icon-calendar form-icon-right">
                                    <em class="icon ni ni-calendar-alt"></em>
                                </div>
                                {{ form.dia_solicitacao }}
                                <label class="form-label-outlined label-search" for="id_dia_solicitacao">Dia da Solicitacao</label>
                            </div>
                        </div>
                    </div>  
                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 container-input-create-secundary">
                        <div class="form-group">
                            <div class="form-control-wrap">
                                <div class="form-icon icon-calendar form-icon-right">
                                    <em class="icon ni ni-calendar-alt"></em>
                                </div>
                                {{ form.dia_analise }}
                                <label class="form-label-outlined label-search" for="id_dia_analise">Dia da Análise</label>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 container-input-create-secundary">
                        <div class="form-group">
                            <div class="form-control-wrap">
                                {% if form.estabelecimento %}
                                {{ form.estabelecimento }}
                                <label class="form-label-outlined label-search" for="id_estabelecimento">Estabelecimento</label>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% if form.representante %}
                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 container-input-create-secundary">
                        <div class="form-group">
                            <div class="form-control-wrap">
                                {{ form.representante }}
                                <label class="form-label-outlined label-search" for="id_representante">Gerentes</label>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% if form.representante %}
                    <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 container-input-search text-right form-group">
                        <button class="col-3 col-sm-2 col-md-2 col-lg-1 col-xl-1 justify-content-center btn btn-success btn-search form-control-lg">
                            <em class="icon ni ni-search"></em>
                        </button>
                    </div>
                    {% else %}
                    <div class="col-xl-4 col-lg-12 col-md-12 col-sm-12 container-input-search text-right form-group">
                        <button class="col-3 col-sm-2 col-md-2 col-lg-1 col-xl-3 justify-content-center btn btn-success btn-search form-control-lg">
                            <em class="icon ni ni-search"></em>
                        </button>
                    </div>
                    {% endif %}
                </form>
            </div>
        </div>
        
        <div class="card table-responsive-xl overflow-auto">
            <div class="nav nav-tabs" id="nav-tab" role="tablist"">
                <button id="tabelaDefault" class="nav-link active-tabs tabs-margin" data-bs-toggle="tab" type="button" role="tab" aria-controls="nav-profile" aria-selected="false" onclick="mudarTabela(event, 'tabelaAgurdando')">Aguardando Análise</button>
                <button class="nav-link tabs-margin" data-bs-toggle="tab" type="button" role="tab" aria-controls="nav-profile" aria-selected="false" onclick="mudarTabela(event, 'tabelaConfirmado')">Solicitações Confirmadas</button>
                <button class="nav-link tabs-margin" data-bs-toggle="tab" type="button" role="tab" aria-controls="nav-profile" aria-selected="false" onclick="mudarTabela(event, 'tabelaNegado')">Solicitações negadas</button>
            </div>
            <table id="tabelaAgurdando" class="table position-relative table-content">
                <thead class="thead-dark text-center thead-content">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Rota</th>
                        <th scope="col">Gerentes</th>
                        <th scope="col">Data da Solicitacao</th>
                        <th scope="col">PDV</th>
                        <th scope="col">Status</th>
                        <th scope="col">Valor da solicitacao</th>
                        <th scope="col">Saldo Atual</th>
                        <th scope="col">Tipo de transação</th>
                        <th scope="col">Ação</th>
                    </tr>
                </thead>
                <tbody class="text-center tbody-content">
                    {% for solicitacao in solicitacoes %}
                    <tr>
                        <td scope="row">{{ solicitacao.id }}</td>
                        <td scope="row">{{ solicitacao.pdv.estabelecimento.franquia }}</td>
                        <td scope="row">{{ solicitacao.pdv.estabelecimento.gerencias.all |join:", " }}
                        <td scope="row">{{ solicitacao.data_solicitacao |date:"SHORT_DATETIME_FORMAT"}}</td>
                        <td scope="row">{{ solicitacao.pdv }}</td>
                        <td scope="row">{{ solicitacao.get_status_display }}</td>
                        <td scope="row">{{ solicitacao.valor }}</td>
                        <td scope="row">{{ solicitacao.pdv.saldo_liquido }}</td>
                        <td scope="row">{{ solicitacao.get_tipo_display }}</td>
                        {% if solicitacao.status == 'A' %}
                        <td scope="row">
                            <a href="/negar_solicitacao_recolhe/solicitacao/{{ solicitacao.id }}" class="btn btn-danger btn-create-secondary btn-tamanho-fixed">Negar</a>
                            <a href="/confirmar_solicitacao_recolhe/solicitacao/{{ solicitacao.id }}" class="btn btn-success btn-create-secondary btn-tamanho-fixed">Confirmar</a>
                        </td>
                        {% else %}
                        <td>
                            <a class="btn btn-disabled btn-create-secondary btn-tamanho-fixed"></a>
                            <a class="btn btn-disabled btn-create-secondary btn-tamanho-fixed"></a>
                        </td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <table id="tabelaNegado" class="table position-relative table-content">
                <thead class="thead-dark text-center thead-content">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Rota</th>
                        <th scope="col">Gerentes</th>
                        <th scope="col">Data da Solicitacao</th>
                        <th scope="col">PDV</th>
                        <th scope="col">Status</th>
                        <th scope="col">Valor da solicitacao</th>
                        <th scope="col">Tipo de transação</th>
                        <th scope="col">Analisado Por</th>
                        <th scope="col">Data da Análise</th>
                    </tr>
                </thead>
                <tbody class="text-center tbody-content">
                    {% for solicitacao in solicitacoes_negadas %}
                    <tr>
                        <td scope="row">{{ solicitacao.id }}</td>
                        <td scope="row">{{ solicitacao.pdv.estabelecimento.franquia }}</td>
                        <td scope="row">{{ solicitacao.pdv.estabelecimento.gerencias.all |join:", " }}
                        <td scope="row">{{ solicitacao.data_solicitacao |date:"SHORT_DATETIME_FORMAT"}}</td>
                        <td scope="row">{{ solicitacao.pdv }}</td>
                        <td scope="row">{{ solicitacao.get_status_display }}</td>
                        <td scope="row">{{ solicitacao.valor }}</td>
                        <td scope="row">{{ solicitacao.get_tipo_display }}</td>
                        <td scope="row">{{ solicitacao.leiturista }}</td>
                        <th scope="row">{{ solicitacao.data_resposta |date:"SHORT_DATETIME_FORMAT" }}</th>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <table id="tabelaConfirmado" class="table position-relative table-content">
                <thead class="thead-dark text-center thead-content">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Rota</th>
                        <th scope="col">Gerentes</th>
                        <th scope="col">Data da Solicitacao</th>
                        <th scope="col">PDV</th>
                        <th scope="col">Status</th>
                        <th scope="col">Valor da solicitacao</th>
                        <th scope="col">Tipo de transação</th>
                        <th scope="col">Analisado Por</th>
                        <th scope="col">Data da Análise</th>
                    </tr>
                </thead>
                <tbody class="text-center tbody-content">
                    {% for solicitacao in solicitacoes_confirmadas %}
                    <tr>
                        <td scope="row">{{ solicitacao.id }}</td>
                        <td scope="row">{{ solicitacao.pdv.estabelecimento.franquia }}</td>
                        <td scope="row">{{ solicitacao.pdv.estabelecimento.gerencias.all |join:", " }}
                        <td scope="row">{{ solicitacao.data_solicitacao |date:"SHORT_DATETIME_FORMAT"}}</td>
                        <td scope="row">{{ solicitacao.pdv }}</td>
                        <td scope="row">{{ solicitacao.get_status_display }}</td>
                        <td scope="row">{{ solicitacao.valor }}</td>
                        <td scope="row">{{ solicitacao.get_tipo_display }}</td>
                        <td scope="row">{{ solicitacao.leiturista }}</td>
                        <td scope="row">{{ solicitacao.data_resposta |date:"SHORT_DATETIME_FORMAT"}}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
    $( document ).ready(function() {
        let modal = $('#modalErro');
        const params = new URLSearchParams(window.location.search)
        if (params.get('success') == 1){
            alert("Recolhe Efetuado com sucesso!")
            window.location.href = {{ request.path }}
        }
        $('#tabelaAgurdando').DataTable({
            "language": {
                "url":"https://cdn.datatables.net/plug-ins/1.10.24/i18n/Portuguese-Brasil.json",
            },
            "dom": '',
            paging: false,
            columnDefs: [
                { orderable: false, targets: [1,8] }
            ],   
        });
        $('#tabelaNegado').DataTable({
            "language": {
                "url":"https://cdn.datatables.net/plug-ins/1.10.24/i18n/Portuguese-Brasil.json",
            },
            "dom": '',
            paging: false,
            columnDefs: [
                { orderable: false, targets: [1,8] }
            ],   
        });
        $('#tabelaConfirmado').DataTable({
            "language": {
                "url":"https://cdn.datatables.net/plug-ins/1.10.24/i18n/Portuguese-Brasil.json",
            },
            "dom": '',
            paging: false,
            columnDefs: [
                { orderable: false, targets: [1,8] }
            ],   
        });
    });
    document.getElementById("tabelaDefault").click();  
    function mudarTabela(evt, nomeTabela) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("table position-relative table-content");
        for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("nav-link tabs-margin");
        for (i = 0; i < tablinks.length; i++) {
          tablinks[i].className = tablinks[i].className.replace("active-tabs", "");
        }
        $('#'+nomeTabela).show()
        evt.currentTarget.className += " active-tabs";
      }
    
</script>
{% endblock %} 