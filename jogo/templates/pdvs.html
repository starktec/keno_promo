{% extends "index.html" %}
{% block titulo %}
VENDEDORES
{% endblock %}
{% block nav-bar %} 
        <!-------------------------------barra de pesquisa-------------------------------->
        <div class="row">
            <div class="col-lg-12">
                <div class="card crud-bar">
                    <div class="row justify-content-center align-items-center form-group">
                        <form action="" method="post" class="col-xs-12 col-sm-12 col-md-12 col-xl-12 row justify-content-start">
                            {% csrf_token %}
                            <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 container-input-create-secundary">
                                <div class="form-group">
                                    <div class="form-control-wrap">
                                        {{ form.estabelecimento }}
                                        <label class="form-label-outlined label-search" for="id_representante">Estabelecimento</label>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 container-input-create-secundary">
                                <div class="form-group">
                                    <div class="form-control-wrap">
                                        {{ form.estabelecimento_digitado }}
                                        <label class="form-label-outlined label-search" for="id_representante">Estabelecimento</label>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 col-sm-2 col-md-2 col-lg-1 col-xl-1 container-input-search text-right form-group">
                                <button class="col-3 col-sm-12 col-md-12 col-lg-12 col-xl-12 justify-content-center btn btn-success btn-search form-control-lg">
                                    <em class="icon ni ni-search"></em>
                                </button>
                            </div>

                        </form>

                    </div>
                </div>
            </div>
        </div>
        <!------------------------------------------------------------------------------->


        {% comment %} <!-------------------------------tabela de generica de franquias--------------------------------> {% endcomment %}
        <div class="row my-row">
            <div class="col-12">
                <div class="card table-margin table-responsive-xl">
                    <table id="tabelaVendedores1" class="table">
                        <thead class="thead-dark text-center">
                          <tr>
                            <th scope="col">Código</th>
                              <th>Rota</th>
                              <th scope="col">Estabelecimento (POS)</th>
                              {% comment %} <th scope="col">Código</th> {% endcomment %}
                              <th scope="col">Situação</th>
                              <th scope="col">Vendedor atual</th>
                              <th scope="col">Saldo atual do vendedor </th>
                              <th scope="col">Alterar saldo para </th>
                              {% if request.session.perfil_max < 5 %}
                              <th scope="col">Excluir da POS</th>
                              {% if usuarios %}
                                <th scope="col">Alterar vendedor para</th>
                              {% endif %}
                              {% endif %}
                          </tr>
                        </thead>
                        <tbody class="text-center">
                        {% for pdv in pdvs %}

                            <tr>
                                <td>{{ pdv.id }}</td>
                                <td>{{ pdv.estabelecimento.franquia }}</td>
                                <td>{{ pdv }}</td>
                                {% comment %} <td>{{ pdv.codigo }}</td> {% endcomment %}
                                <td>{% if pdv.ativo %}ATIVO{% else %}INATIVO{% endif %}</td>
                                <td>
                                    {% if pdv.vendedor %}{{ pdv.vendedor }}
                                    {% endif %}
                                </td>
                                <td>{% if pdv.vendedor %}{{ pdv.vendedor.saldo_venda }}
                                    {% endif %}
                                </td>
                                {% if request.session.perfil_max < 5 %}
                                <td>
                                    <form  id="formsaldo{{ pdv.id }}" method="post">{% csrf_token %}
                                        <div class="row">
                                            <input name="pdv_id" type="hidden" value="{{ pdv.id }}">
                                            <input name="novo_saldo" id="saldo" type="number" required  min="0" autocomplete="off" class="col-6 col-sm-6 col-md-6 col-lg-6 form-control form-control-lg form-control-outlined">
                                            <input form="formsaldo{{ pdv.id }}" type="submit" value="Alterar" class="col-6 col-sm-6 col-md-6 col-lg-6 btn btn-lg btn-primary btn-search btn-success">
                                        </div>
                                    </form>
                                </td>
                                {% endif %}
                                <td>
                                    {% if pdv.vendedor %}
                                    <a href="/pos/{{ pdv.id }}/remove/" class="btn btn-danger btn-create-secondary">
                                        <em class="icon ni ni-trash"></em>
                                    </a>
                                    {% endif %}
                                </td>
                                {% if request.session.perfil_max < 5 %}
                                {% if usuarios %}
                                <td>
                                    <form method="post">{% csrf_token %}
                                        <select name="novovendedor" class="form-select-sm form-control form-control-outlined" onchange="this.form.submit();">
                                            <option value="" selected></option>
                                            {% for u in usuarios %}
                                            <option value="{{ pdv.id }},{{ u.id }}">{{ u.usuario.get_full_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </form>
                                </td>
                                {% endif %}
                                {% endif %}
                            </tr>

                        {% endfor %}

                        </tbody>
                      </table>

                </div>
            </div>
        </div>
        <!-------------------------------------------------------------------------------------------->
        <!-------------------------------tabela de generica de usuarios candidatos a vendedor-------------------------------->
        <div class="row my-row">
            <div class="col-12">
                <div class="card table-responsive-xl">
                    <table id="tabelaCandidato" class="table">
                        <!--<thead class="">
                        </thead>-->
                        <thead class="thead-dark text-center">
                          <tr>
                              <th scope="col" colspan="6"><h6 style="color:white;">Lista de candidatos a vendedores</h6></th>
                          </tr>
                          <tr>
                              <th scope="row">Código</th>
                              <th scope="row">Rota</th>
                              <th scope="col">Nome</th>
                            <th scope="col">login</th>
                            <th scope="col">Perfis</th>

                          </tr>
                        </thead>
                        <tbody class="text-center">
                        {% for u in usuarios %}

                            <tr>
                                <th scope="row">{{ u.id }}</th>
                                <td>{{ u.franquias.all|join:", " }}</td>
                                <td>{{ u.usuario.get_full_name }}</td>
                                <td>{{ u.usuario.username }}</td>
                                <td>{{ u.perfis.all|join:", " }}</td>

                            </tr>

                        {% endfor %}

                        </tbody>
                      </table>

                </div>
            </div>
        </div>
        <!-------------------------------------------------------------------------------------------->

    </div>

</div>
<script>
    $(document).ready( function () {
        $('#tabelaCandidato').DataTable({
            "language": {
                "url":"https://cdn.datatables.net/plug-ins/1.10.24/i18n/Portuguese-Brasil.json",
            },
            "dom": 't<"pagination"p>',
            paging: false,
            "drawCallback": function( settings ) {
                $('#tabelaCandidato ul').addClass("pagination");
            }
        });
        $('#tabelaVendedores1').DataTable({
            "language": {
                "url":"https://cdn.datatables.net/plug-ins/1.10.24/i18n/Portuguese-Brasil.json",
                "infoEmpty" : "Nenh"
            },
            "dom": '',
            paging: false,
            columnDefs: [
                { orderable: false, targets: [5,6] }
            ],
        });
        
    } );
</script>
{% endblock %}